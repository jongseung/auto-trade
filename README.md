# 단기매매 시스템 분석 및 전략 요약

## 1. 시스템 개요

이 단기매매 시스템은 KOSPI 및 KOSDAQ 시장에서 '상한가 돌파 가능 종목'을 선별하여 단기(당일~3거래일) 내에 차익을 실현하는 자동화 시스템입니다. 한국투자증권의 공식 API를 활용하여 시세, 호가, 계좌 정보 등을 실시간으로 수집하고, 다양한 기술적 지표와 뉴스 정보를 분석하여 매매 의사결정을 지원합니다.

### 주요 목표

- **목표 수익률**: 일별 평균 +3% ~ +7%
- **투자 기간**: 진입일 당일부터 최대 3거래일 내 청산
- **데이터 소스**: 한국투자증권 공식 API (시세, OHLCV, 공시, 호가 정보 등)

### 주요 모듈 구성

1. **인증 모듈(auth.py)**: 한국투자증권 API 인증 처리
2. **데이터 수집 모듈(data_collector.py)**: 시장 데이터, 종목 정보, 계좌 정보 수집
3. **종목 스크리닝 모듈(stock_screener.py)**: 매매 대상 종목 선별
4. **매매 실행 모듈(trade_executor.py)**: 주문 실행, 익절/손절 관리
5. **뉴스 분석 모듈(news_analyzer.py)**: 뉴스 및 테마 정보 분석
6. **실시간 모니터링 모듈(realtime_monitor.py)**: 실시간 시세 모니터링
7. **백테스팅 모듈(backtester.py)**: 전략 백테스팅 및 성과 분석
8. **리스크 관리 모듈(risk_manager.py)**: 동적 리스크 관리 및 포트폴리오 최적화

## 2. 종목 선별 전략

### 기본 스크리닝 기준

1. **거래량 기반 분석**

   - 최근 3거래일 평균 대비 거래량 ≥ 2.5배
   - 최근 3거래일 평균 대비 거래대금 ≥ 3배

2. **이동평균 및 이격도 분석**

   - 5일 이동평균선 위 마감
   - 종가/5일선 이격도 ≥ +3%

3. **시초가 갭업 분석**

   - 당일 시초가 갭업 ≥ +2%

4. **차트 패턴 분석**
   - 최근 3거래일 연속 종가 상승 확인

### 고급 스크리닝 지표

1. **고점 돌파 확인**

   - 20일 고점 돌파 여부

2. **기술 지표 분석**

   - RSI(상대강도지수) 상태 확인 (과매수/과매도 구간)
   - ATR(평균진폭) 대비 갭폭 비율
   - 골든 크로스 발생 여부 (MA20이 MA60 상향 돌파)

3. **호가 분석**

   - 매수/매도 호가 비율
   - 체결강도

4. **뉴스 및 테마 분석** (USE_NEWS=true인 경우)
   - 최근 관련 뉴스 건수
   - 뉴스 감성 점수 (긍정/부정)
   - 인기 테마 연관성

### 종목 점수 산정 방식

각 지표별로 가중치를 부여하고 합산하여 최종 점수 산출:

1. **거래량 증가 (배율)**: 최대 30점
2. **거래대금 증가 (배율)**: 최대 45점
3. **5일선 이격도 (비율)**: 최대 60점
4. **갭업 비율 (비율)**: 최대 75점
5. **3일 연속 종가 상승**: 15점
6. **20일 고점 돌파**: 20점
7. **ATR 대비 갭폭 비율**: 최대 45점
8. **RSI 상태**: -10 ~ 15점
9. **골든 크로스**: 25점
10. **호가 비율**: 최대 15점
11. **체결강도**: 최대 25점
12. **뉴스 점수**: 최대 15점 (뉴스 감성에 따라 조정)

최종 점수가 높은 순서대로 상위 종목을 선별합니다.

## 3. 진입(Entry) 전략

### 기본 진입 조건

- 스크리닝 통과 종목 중 상위 종목(설정된 최대 보유 종목 수 범위 내) 시장가 매수
- 자동매매 시 시스템이 선별한 종목을 단계적으로 매수

### 매수 수량 결정

- 총 자산의 MAX_STOCK_RATIO(5%) 이내로 종목별 투자
- 최대 MAX_STOCK_COUNT(3개) 종목까지 동시 보유 가능

### 진입 타이밍

- 장 시작 직후(09:00~09:10): 시초가 갭업이 발생한 종목 매수
- 장중 지속적 스크리닝을 통한 새로운 기회 포착

## 4. 청산(Exit) 전략

### 익절(Take-Profit)

- 수익률이 PROFIT_CUT_RATIO(5%) 이상 도달 시 전량 매도

### 손절(Stop-Loss)

- 수익률이 -LOSS_CUT_RATIO(-2%) 이하로 하락 시 전량 매도

### 시간 기반 청산

- MAX_HOLD_DAYS(3일) 이상 보유 시 성과와 무관하게 전량 매도

### 전체 손실 관리

- 일일 손실 한도(MAX_DAILY_LOSS: 3%)에 도달 시 전량 청산 후 매매 중단

## 5. 리스크 관리

### 포트폴리오 구성

- 총 자산의 MAX_INVESTMENT_RATIO(20%) 이내 투자
- 종목별 최대 투자 비중: 총 자산의 MAX_STOCK_RATIO(5%)
- 최대 보유 종목 수: MAX_STOCK_COUNT(3개)

### 손실 관리

- 일일 최대 손실률: MAX_DAILY_LOSS(3%)
- 개별 종목 손절 기준: LOSS_CUT_RATIO(2%)

### 매매 타이밍 관리

- 최대 보유 기간: MAX_HOLD_DAYS(3일)
- 09:00 ~ 15:30 사이만 매매 실행 (주말 제외)

### 동적 리스크 관리 (신규 기능)

- 시장 변동성에 따른 리스크 상태 관리 (NORMAL, CAUTION, RISK)
- 리스크 상태별 투자 비중 자동 조정
- ATR 기반 동적 손절/익절 설정
- 종목 특성(변동성, 베타)에 따른 포지션 사이즈 최적화
- 일일 손실 추적 및 한도 관리

## 6. 운영 워크플로우

### 장 전(08:30) 준비

- API 인증 및 토큰 발급
- 계좌 상태 확인
- 초기 종목 스크리닝 실행

### 시초가 매매(09:00~09:10)

- 스크리닝된 종목 중 조건에 맞는 종목 매수

### 장중 모니터링(09:10~15:20)

- 정기적 스크리닝 업데이트 (설정된 간격마다)
- 보유 종목 손익 모니터링
- 익절/손절 조건 확인 및 실행
- 신규 매수 기회 탐색

### 종가 정리(15:20~15:30)

- 필요시 미체결 주문 정리
- 당일 성과 분석

### 장 후 평가

- 매매 기록 저장 및 분석
- 전략 성과 평가

## 7. 시스템 특징 및 차별점

### 데이터 소스 최적화

- 한국투자증권 공식 API를 활용한 안정적인 데이터 파이프라인 구축
- 실시간 시세, 호가, 체결 데이터 활용

### 다층적 스크리닝

- 기본 기술적 지표와 고급 지표를 결합한 종합적 분석
- 거래량, 모멘텀, 차트 패턴, 이격도 등 다양한 요소 고려

### 뉴스 및 테마 분석 통합

- 뉴스 감성 분석을 통한 추가적인 선별 기준 제공
- 인기 테마와 연관된 종목 가중치 부여

### 실시간 모니터링 및 대응

- 시장 상황 변화에 따른 실시간 대응 가능
- 자동화된 익절/손절 로직

### 종합적 리스크 관리

- 개별 종목, 포트폴리오, 일일 손실 등 다층적 리스크 관리
- 최대 보유 기간 설정으로 시간 리스크 제한
- 시장 상황에 따른 동적 리스크 관리 (신규 기능)

### 백테스팅 및 성과 분석 (신규 기능)

- 과거 데이터 기반 전략 성과 검증
- 다양한 성과 지표 제공 (수익률, 샤프 비율, MDD 등)
- 최적 파라미터 도출 및 전략 개선

## 8. 시스템 구성 요소 상세

### 주요 파일 구조

- **main.py**: 메인 실행 모듈
- **run.py**: 간소화된 실행 스크립트
- **modules/**: 핵심 기능 모듈 디렉토리
  - auth.py: 인증 모듈
  - data_collector.py: 데이터 수집 모듈
  - stock_screener.py: 종목 스크리닝 모듈
  - trade_executor.py: 매매 실행 모듈
  - news_analyzer.py: 뉴스 분석 모듈
  - realtime_monitor.py: 실시간 모니터링 모듈
  - logger.py: 로깅 모듈
- **backtesting/**: 백테스팅 관련 모듈 (신규)
  - backtester.py: 백테스팅 코어 모듈
- **risk/**: 리스크 관리 관련 모듈 (신규)
  - risk_manager.py: 동적 리스크 관리 모듈
- **config/**: 설정 파일 디렉토리
  - config.py: 주요 설정 파일
- **data/**: 데이터 저장 디렉토리
  - token\_\*.txt: 토큰 저장 파일
  - trade_history.csv: 매매 기록 파일
  - reports/: 일일 리포트 저장 디렉토리
  - backtest/: 백테스팅 결과 저장 디렉토리
  - risk_logs/: 리스크 평가 로그 저장 디렉토리
- **logs/**: 로그 파일 디렉토리

### 주요 설정 파라미터

- **인증 설정**: APP_KEY, APP_SECRET, CANO, ACNT_PRDT_CD
- **매매 설정**: MAX_INVESTMENT_RATIO, MAX_STOCK_RATIO, MAX_STOCK_COUNT
- **손익 설정**: MAX_DAILY_LOSS, PROFIT_CUT_RATIO, LOSS_CUT_RATIO, MAX_HOLD_DAYS
- **스크리닝 설정**: MIN_VOLUME_RATIO, MIN_TRADING_VALUE_RATIO, MIN_MA5_DEVIATION, MIN_GAP_UP_RATIO
- **리스크 관리 설정**: VIX_THRESHOLD, RISK_CHECK_INTERVAL
- **백테스팅 설정**: BACKTEST_INITIAL_CAPITAL, BACKTEST_COMMISSION, BACKTEST_TAX

## 9. 사용 방법

### 기본 실행

```bash
python main.py --mode run
```

### 1회 실행 모드

```bash
python main.py --mode once
```

### 데모 모드 실행 (API 호출 없음)

```bash
python main.py --mode once --demo
```

### 백테스팅 실행

```bash
python main.py --mode backtest --start-date 2023-01-01 --end-date 2023-12-31
```

### 리스크 평가만 실행

```bash
python main.py --risk-assessment
```

## 10. 결론

이 단기매매 시스템은 한국투자증권 API를 활용하여 KOSPI 및 KOSDAQ 시장에서 상한가 돌파 가능성이 높은 종목을 식별하고 체계적으로 매매하는 자동화 솔루션입니다. 다양한 기술적 지표와 거래량 분석, 뉴스 정보를 종합적으로 활용하여 고성능의 스크리닝 시스템을 구축했으며, 철저한 리스크 관리를 통해 안정적인 수익을 추구합니다.

모듈식 설계로 유지보수와 기능 확장이 용이하며, 실시간 모니터링과 자동 매매 실행을 통해 시장 기회를 포착하고 빠르게 대응할 수 있습니다. 백테스팅 모듈을 통한 전략 검증과 동적 리스크 관리 시스템을 통해 다양한 시장 상황에 효과적으로 대응할 수 있는 기반을 갖추고 있습니다.

지속적인 성과 분석과 전략 최적화를 통해 더욱 발전된 매매 시스템으로 진화할 수 있는 기반을 갖추고 있습니다.
